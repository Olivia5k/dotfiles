#!/bin/zsh

# mux-or-raise
# Uses i3 and tries to raise a given tmux session (remote or local). If it
# isn't found, it will be started.
# Written by Lowe Thiderman (lowe.thiderman@gmail.com)

sess=${1:-main}
host=${2:-$HOST}
cmd=$3
title="${sess}@${host}"

# Try to get focus. Do not care whether it works or not
wmraise $title

# If the session is not running in a terminal, start it
if [[ $(ps ax | grep "mux $sess" -c) -lt 3 ]] ; then
  term="urxvt -name $title"

  if [[ "$host" =~ "($HOST|localhost)" ]]; then
    ${(z)term} -e mux $sess $cmd
  else
    ${(z)term} -e ssh $host -t .local/share/infect/util/mux $sess $cmd
  fi
fi
